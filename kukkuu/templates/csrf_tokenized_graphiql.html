{% extends 'graphene/graphiql.html' %}

{% block body_extra %}
<script>
// Add CSRF token to all GraphiQL fetch requests to make CSRF work with GraphiQL.
//
// window.fetch function's `options` parameter is an optional RequestInit,
// which has an optional `headers` property which can be Headers or an object.
//
// See documentations:
// - https://developer.mozilla.org/en-US/docs/Web/API/Window/fetch
// - https://developer.mozilla.org/en-US/docs/Web/API/RequestInit
// - https://developer.mozilla.org/en-US/docs/Web/API/Headers
const originalFetch = window.fetch;
window.fetch = function(resource, options = undefined) {
    if (options) {
        options.headers = options.headers ?? {};
        if (options.headers instanceof Headers) {
            options.headers.set('{{ csrf_header_name }}', '{{ csrf_token }}');
        } else {
            options.headers['{{ csrf_header_name }}'] = '{{ csrf_token }}';
        }
    }
    return originalFetch(resource, options);
};
</script>
{% endblock %}
